# 🛰️ 遥感影像处理工具软件

本软件是一款面向科研人员与遥感工程师的桌面级遥感处理工具，支持影像正射校正、图层可视化、激光点云抽稀、SHP边界提取、压缩解包等功能，并具有较强的并行处理能力与良好的图形界面交互体验。

## 🗂️ 软件功能概览

| 功能模块       | 简要说明                                                     |
| -------------- | ------------------------------------------------------------ |
| 新建工程       | 设置统一的输出与日志路径，作为本次工程的工作空间。           |
| 文件处理       | 包括压缩包解压，激光数据处理（格式转换、均匀抽稀）。         |
| 摄影测量与遥感 | 包含影像正射校正、边界SHP提取、图层加载显示等遥感处理操作。  |
| 图层可视化     | 支持多图层加载、叠加、显示控制、图层删除与居中定位。         |
| 坐标查看与缩放 | 实时显示鼠标所指地理坐标，支持同步缩放所有图层。             |
| 日志输出与导出 | 每次功能运行的输出都会记录至“输出日志”区域，并保存在工程目录下自动命名的 `log_yyyy_mm_dd_hh_mm_ss.txt` 文件中。 |

---

## 📂 主界面说明

主界面由三部分组成：

- 左侧：图层列表（支持勾选显示/隐藏、右键删除、双击定位）
- 中间：影像显示区（支持地图缩放、图层叠加、鼠标坐标查看）
- 下方：任务进度条 + 实时输出日志框（支持自动滚动至最新）

拖动区域采用 `QSplitter` 分隔，并设置灰色分割线样式便于用户交互。

---

## 📁 功能菜单说明

### 1️⃣ 新建工程（菜单项：“新建工程”）

- 功能：选择一个文件夹作为工程目录，所有输出文件（正射影像、边界SHP、日志等）将自动保存在该路径。
- 路径选择后将创建工程时间戳命名的日志文件，记录所有操作。

---

### 2️⃣ 文件处理（菜单项：“文件处理”）

#### 📦 解压功能

- 支持 `.zip` 文件和压缩文件夹的解压。
- 自动识别输入路径中的压缩包并解压至用户指定路径。
- 解压过程使用线程异步处理，避免界面卡顿。

#### 📉 激光点抽稀功能（“激光数据处理”子菜单）

- 提供均匀抽稀方式，支持用户设定目标点数。
- 采用后台线程处理大规模点数据。
- 支持输出保持原始 `.txt` 格式并自动修正点数头。

---

### 3️⃣ 摄影测量与遥感（菜单项：“摄影测量与遥感”）

#### 📐 正射影像处理

- 输入：包含 `.tif`（或 `.tiff` 等变体）及对应 `_rpc.txt` 文件的文件夹。
- 输出：正射影像存储在工程路径下 `orthorectified/` 文件夹中。
- 特性：
  - 多线程处理影像（使用 `concurrent.futures.ThreadPoolExecutor`）。
  - 自动加载至图层中显示，支持显示控制与位置同步。

#### 🧭 提取影像边界（“SHP”子菜单）

- 功能：“边界SHP提取”按钮打开一个对话框：
  - 输入路径：包含 .tif 和 .rpb 文件的影像目录。
  - 保存路径：边界 `shp` 文件默认保存在 `工程路径/boundary/` 目录下。
- 实现逻辑：
  - 利用 `gdal.Transformer` + RPC模型将影像四角像素转换为经纬度。
  - 使用 `shapely` 和 `geopandas` 构建面状边界并保存。
  - 多线程（QRunnable + QThreadPool）处理所有影像，支持日志反馈。

---

## 🗺️ 图层管理与显示

- 使用 `QGraphicsScene` 显示影像图层，支持缩放、漫游、图层透明叠加。
- 图层加载后：
  - 会显示在左侧图层列表中（带勾选框）。
  - 支持：勾选隐藏、右键删除、双击定位、缩放同步。
- 图层渲染通过 `LayerManager.render_combined()` 实现叠加显示。
- 坐标显示基于图层 `transform` 与鼠标像素坐标变换。

---

## 🧠 实现细节与逻辑结构

### 核心类与模块

| 模块路径                     | 说明                                                   |
| ---------------------------- | ------------------------------------------------------ |
| `main_window.py`             | 主窗口布局与功能菜单逻辑处理入口                       |
| `map_canvas.py`              | 图像显示与地图渲染逻辑，支持多图层叠加、缩放、坐标解析 |
| `layer_manager.py`           | 图层状态控制、叠加显示、删除等逻辑                     |
| `image_loader.py`            | 异步加载图像并提取 GeoTransform 转换参数               |
| `orthorectify_logic.py`      | 调用GDAL实现RPC正射处理，封装为任务函数                |
| `extract_boundary_worker.py` | 多线程提取影像边界 shapefile，含异常处理反馈           |
| `downsample_worker.py`       | 处理点云抽稀，运行于线程中避免卡顿                     |

---

## 🔧 使用说明

1. 打开软件，点击“新建工程”设置路径。
2. 根据需要：
   - 解压文件：进入“文件处理”→“解压”
   - 抽稀点云：进入“文件处理”→“激光数据处理”→“激光点抽稀”
   - 正射影像：进入“摄影测量与遥感”→“正射影像”
   - 边界提取：进入“摄影测量与遥感”→“SHP”→“边界SHP提取”
3. 所有操作的中间与最终结果将记录在日志区及工程日志文件中。
4. 输出图像自动加载到中部地图显示区，可通过图层列表控制其显示与删除。

---

## 🔮 建议与扩展方向

- ✅ 已支持线程池加速影像处理与边界提取。
- ✅ 已支持图层可视化、缩放、坐标解析。
- 🔄 待实现功能：
  - SHP文件合并（按钮已预留）
  - 支持DEM辅助正射
  - 支持不同底图之间精配准（如前视后视影像差异修正）
- 🚀 可扩展功能：
  - 支持多源影像配准与配图（SAR、光学、激光）
  - 三维点云显示与交互
  - 成果一键导出（PDF报告、CSV坐标点等）

---
